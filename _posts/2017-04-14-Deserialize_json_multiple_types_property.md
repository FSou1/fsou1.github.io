---
layout: post
title: Десериализация нетипизированного JSON поля на строготипизированный объект .NET с использованием Newtonsoft.Json
---

Встречали ли вы JSON объекты, поля которых не имеют строгой типизации, а точнее, тип которых может варьироваться от `string` и `numeric` до `Object`? Если ответ положительный, то вы могли заметить, что красотой решения десериализации подобных объектов не блещут, однако, об одном из них я бы и хотел сегодня написать.

## Задача

Внешний (неподконтрольный нам API) предоставляет следующий формат ответа, который нам требуется десериализовать на строготипизированный объект:

Ответ:

```javascript
{
   "contact":[
      {
         "type":"cell",
         "value":{
            "country":"7",
            "city":"123",
            "number":"4567890",
            "formatted":"+71234567890"
         }
      },
      {
         "type":"email",
         "value":"applicant@example.com"
      },
      {
          "type":"vk_id",
          "value": 12342341
      }
   ]
}
```

Как вы могли заметить, значение поля `value` объекта `contact` не имеет строго определённого типа:

1. Если тип контакта `cell` то тип значения `Object`;
2. Если тип контакта `email` то тип значения `string`;
3. Возможны так же значения типа `int` и `Array`;

В .NET нет возможности объявить тип, который будет единообразно хорошо и удобно поддерживать весь предполагаемый зоопарк значений, в связи с этим для каждого возможного варианта мы будем использовать собственный тип:

1. Для телефона- `class`; 
2. Для email- `string`;
3. Для идентификатора- `long`;

# Решение с использованием JsonConverter



Исходники доступны на [GitHubGist src](https://gist.github.com/FSou1/daeff50471419de025f7dab9c744df1c).